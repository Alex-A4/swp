<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ws="ws-component">
<head>
   <title>Demo: Views</title>
   <script type="text/javascript">
      window.wsConfig = {
         WSRootPath: '/sbis3-ws/ws/',
         wsRoot: '/sbis3-ws/ws/',
         WSTheme: 'wi_scheme',
         resourceRoot: '/',
         nostyle: true,
         globalConfigSupport: false
      };
      window.WSTheme = 'wi_scheme';
   </script>
   <script type="text/javascript" id="dev-style-enable">
      (function () {
         window.wsConfig.nostyle = false;
      })();
   </script>
   <script type="text/javascript" data-pack-name="contents" src="/contents.js"></script>

   <script type="text/javascript" src="/sbis3-ws/ws/ext/requirejs/require.js"></script>
   <script type="text/javascript" src="/sbis3-ws/ws/ext/requirejs/config.js"></script>
   <script type="text/javascript" data-pack-name="ws" src="/sbis3-ws/ws/ext/jquery-min.js"></script>
   <script type="text/javascript" data-pack-name="ws" src="/sbis3-ws/ws/ext/jquery-cookie-min.js"></script>
   <script type="text/javascript" data-pack-name="ws" src="/sbis3-ws/ws/ext/jquery-notouch-min.js"></script>
   <script type="text/javascript" src="/sbis3-ws/ws/lib/core.js"></script>
   <link rel="stylesheet" type="text/css" href="/sbis3-ws/ws/css/core.css"/>
   <script type="text/javascript" data-pack-name="ws" src="/sbis3-ws/ws/res/js/bootup.js"></script>
   <style>
      html, body {
         font-family: 'TensorFont Regular', 'TensorFont'!important;
         font-size: 14px!important;
      }
   </style>
   <style>
      p {
         font-weight: bold;
      }
      #Menu, #MenuBar {
         width: 200px;
      }
      #MenuBar {
         width: 400px;
         overflow: hidden;
      }
      #MenuBar .controls-MenuItem {
         float: left;
         width: 200px;
      }
      .controls-ListView__bottomStyle .controls-ListView__item__selected{
         background: pink;
      }
      .controls-ListView__item__selected {
         color: red;
      }
      .color-1 *{
         background: #f8fab5;
      }

   </style>
   <script type="text/javascript" id="ws-include-css"></script>
   <link rel="stylesheet" type="text/css" href="/sbis3-ws/ws/css/themes/webfonts/fonts.css"/>
   <link rel="stylesheet" type="text/css" href="../components/themes/online/online.css"/>
</head>
<body class="view-main">
<div id="Back"></div>

<div id="area" style="margin: 16px; width:1000px; float: left">

   <div id="btn"></div>
   <div id="btn2"></div>
   <br/><br/>
   <div id="radioBtn"></div>
   <br/><br/>

   <div id="radioBtn2"></div>
   <div id="datagrid" class="controls-ButtonGroup__vertical controls-DataGridView__hasSeparator"></div>
   <br/><br/>
   <div id="checkBox" class="controls-ButtonGroup__vertical"></div>
   <br/><br/>
   <div id="checkBox2"></div>
   <br/><br/>
</div>


<script type="text/javascript">
require(['Core/core-init'],function () {
   $(document).ready(function () {
      require(['Lib/Control/AreaAbstract/AreaAbstract', 'SBIS3.CONTROLS/ListView', 'WS.Data/Source/Memory', 'WS.Data/Query/Query', "SBIS3.CONTROLS/DataGridView", 'SBIS3.CONTROLS/ListView', 'SBIS3.CONTROLS/Radio/Group'], function (AreaAbstract, ListView, Memory, Query, DGV, LV, RadioGroup) {
         var


               coll = [
                  {
                     id: 1,
                     title: 'Настолько длинное название папки что оно не влезет в максимальный размер',
                     'par@': true,
                     groupField : 1
                  },
                  {
                     id: 2,
                     title: 'Notebooks',
                     'par@': true,
                     groupField : 1
                  },
                  {
                     id: 3,
                     title: 'Smartphones',
                     'par@': true,
                     groupField : 1
                  },
                  {
                     id: 4,
                     title: 'Notebook Lenovo G505 59426068',
                     flag: true,
                     img: 'img/4.png',
                     par: 9,
                     'par@': false,
                     price: '11 490',
                     count: 2,
                     groupField : 1
                  },
                  {
                     id: 5,
                     title: 'Notebook Packard Bell EasyNote TE69HW-29572G32',
                     flag: true,
                     img: 'img/5.png',
                     par: 1,
                     'par@': false,
                     price: '15 990',
                     count: 12,
                     groupField : 2
                  },
                  {
                     id: 6,
                     title: 'Notebook ASUS X550LC-XO228H',
                     flag: true,
                     img: 'img/6.png',
                     par: 10,
                     'par@': false,
                     price: '19 990',
                     count: 22,
                     groupField : 2
                  },
                  {
                     id: 7,
                     title: 'Notebook Lenovo IdeaPad G5030 (80G0001FRK)',
                     flag: true,
                     img: 'img/7.png',
                     price: '22 590',
                     par: 9,
                     'par@': false,
                     count: 13,
                     groupField : 2
                  },
                  {
                     id: 8,
                     title: 'Notebook Lenovo G505 59426068',
                     flag: true,
                     img: 'img/8.png',
                     price: '25 100',
                     par: 9,
                     'par@': false,
                     count: 5,
                     groupField : 2
                  },
                  {
                     id: 9,
                     title: 'Lenovo',
                     par: 1,
                     'par@': true,
                     groupField : 3
                  },
                  {
                     id: 10,
                     title: 'ASUS',
                     par: 1,
                     'par@': true,
                     groupField : 3
                  },
                  {
                     id: 11,
                     title: 'Samsung',
                     par: 2,
                     'par@': true,
                     groupField : 3
                  },
                  {
                     id: 12,
                     title: 'SONY',
                     par: 2,
                     'par@': true,
                     groupField : 5
                  },
                  {
                     id: 13,
                     title: 'ASUS',
                     par: 2,
                     'par@': true,
                     groupField : 5
                  },
                  {
                     id: 14,
                     title: 'Sony Xperia Z3 Compact',
                     flag: true,
                     par: 12,
                     'par@': false,
                     price: '20 290',
                     count: 7,
                     groupField : 5
                  },
                  {
                     id: 15,
                     title: 'Samsung Galaxy S6 SM-G920F 32Gb',
                     flag: true,
                     par: 11,
                     'par@': false,
                     price: '31 700',
                     count: 9,
                     groupField : 5
                  },
                  {
                     id: 16,
                     title: 'ASUS ZenFone 2 ZE550ML',
                     flag: true,
                     par: 13,
                     'par@': false,
                     price: '12 890',
                     count: 6,
                     groupField : 5
                  },
                  {
                     id: 17,
                     title: 'Sony Xperia Z3 (D6603)',
                     flag: true,
                     par: 12,
                     'par@': false,
                     price: '24 750',
                     count: 3,
                     groupField : 5
                  },
                  {
                     id: 18,
                     title: 'Samsung Galaxy Note 4 SM-N910C',
                     flag: true,
                     par: 11,
                     'par@': false,
                     price: '29 320',
                     count: 2,
                     groupField : 5
                  },
                  {
                     id: 19,
                     title: 'Вложенные папки',
                     par: 3,
                     'par@': true,
                     groupField : 5
                  },
                  {
                     id: 20,
                     title: 'Для проверки',
                     par: 19,
                     'par@': true,
                     groupField : 5
                  },
                  {
                     id: 21,
                     title: 'Хлебных крошек',
                     par: 20,
                     'par@': true,
                     groupField : 5
                  },
                  {
                     id: 22,
                     title: 'Ооооооооочень',
                     par: 21,
                     'par@': true,
                     groupField : 5
                  },
                  {
                     id: 23,
                     title: 'Многооооооооо',
                     par: 22,
                     'par@': true,
                     groupField : 5
                  },
                  {
                     id: 24,
                     title: 'Папоооооооооок',
                     par: 23,
                     'par@': true,
                     groupField : 5
                  },
                  {
                     id: 25,
                     title: 'Есть даже папки с длинными названиями',
                     par: 24,
                     'par@': true,
                     groupField : 5
                  },
                  {
                     id: 26,
                     title: 'И не очень длинными',
                     par: 25,
                     'par@': true,
                     groupField : 5
                  },
                  {
                     id: 27,
                     title: 'И чуть более длинными',
                     par: 26,
                     'par@': true,
                     groupField : 5
                  },
                  {
                     id: 28,
                     title: 'А тут',
                     par: 27,
                     groupField : 5
                  },
                  {
                     id: 29,
                     title: 'Даже',
                     par: 27,
                     groupField : 5
                  },
                  {
                     id: 30,
                     title: 'что то есть',
                     par: 27,
                     groupField : 5
                  }
               ];

         var rg1 = new RadioGroup({
            element : 'radioBtn',
            items : [
               {
                  'id' : 1,
                  'title' : 'Слева'
               },
               {
                  'id' : 2,
                  'title' : 'По центру'
               },
               {
                  'id' : 3,
                  'title' : 'Справа'
               }
            ],
            selectedIndex : 2,
            keyField : 'id',
            displayField: 'title'
         });
         rg1.subscribe('onSelectedItemChange', function(e, id){
            switch(id) {
               case 1: $('.controls-GroupBy__separator').removeClass('controls-GroupBy__separator__right').removeClass('controls-GroupBy__separator__center'); break;
               case 2: $('.controls-GroupBy__separator').removeClass('controls-GroupBy__separator__right').addClass('controls-GroupBy__separator__center'); break;
               case 3: $('.controls-GroupBy__separator').addClass('controls-GroupBy__separator__right').removeClass('controls-GroupBy__separator__center'); break
            }
         });
         var rg2 = new RadioGroup({
            element : 'radioBtn2',
            items : [
               {
                  'id' : 1,
                  'title' : 'Сворачивание'
               },
               {
                  'id' : 2,
                  'title' : 'Без сворачивания'
               }
            ],
            keyField : 'id',
            displayField: 'title'
         });
         rg2.subscribe('onSelectedItemChange', function(e, id){
            switch(id) {
               case 1: $('.controls-GroupBy__separatorText').addClass('controls-GroupBy__separatorCollapse'); break;
               case 2: $('.controls-GroupBy__separatorText').removeClass('controls-GroupBy__separatorCollapse'); break;

            }
            $('.controls-GroupBy__separatorText').removeClass('controls-GroupBy__separatorCollapse__collapsed');
            $('.js-controls-ListView__item').removeClass('ws-hidden');
         });

         var source = new Memory({
            data: coll,
            idProperty: 'id'
         });

         var query = new Query();
         source.query(query).addCallback(function(list){
            var rs = list.getAll();
            var xxx = new DGV({multiselect: true,
               element: "datagrid",selectedKey : 3,
               //items: rs,
               dataSource: source,
               name: 'psina',
               itemsActions: [],
               /*showHead: false,*/
               columns :[
                  {
                     title : 'id',
                     field : 'id'
                  },
                  {
                     title : 'title',field : 'title', sorting: true

                  },
                  {
                     title : 'xxx', field: 'par',
                     width: 150, sorting : true
                  }
               ],
               sorting: [
                  
               ],
               displayField : 'title',
               keyField:'id',
               itemTpl : '{{it.attributes={myKOKO : "koko"+it.projItem.getHash(), xxx : 1};}}{{=it.defaultItemTpl(it)}}',
               groupBy: {
                  field : 'groupField',
                  contentTemplate : '<div class="controls-GroupBy__separator controls-GroupBy__separator__right"><span class="controls-GroupBy__separatorText controls-GroupBy__separatorCollapse">Группа №{{=it.item.get("groupField")}}</span></div>'
               },
               easyGroup: true
            });
            xxx.subscribe('onSelectedItemChange', function(e, id, index){
               console.log('key - ' + id + ' index - ' + index);
            });

//            var xxx2 = new LV({
//               element: "datagrid",
//               selectedKey : 3,
//               items: coll,
//               displayField : 'title',
//               name: 'psina',
//               keyField: 'id',
//               /*itemTemplate : '<div>123</div>',*/
//               itemTpl : '{{it.className="color-"+it.item.get("color");it.attributes={myKOKO : "koko"+it.projItem.getHash(), xxx : 1};}}{{=it.defaultItemTpl(it)}}',
//               itemContentTpl : '<div>{{=it.item.getId() + " --- " + it.item.get("title")}}</div>',
//               groupBy: {
//                  field : 'groupField',
//                  contentTemplate : '<div class="controls-GroupBy__separator controls-GroupBy__separator__right"><span class="controls-GroupBy__separatorText">++{{=it.item.get("groupField")}}++</span></div>'
//               },
//               easyGroup: true
//            });
//            xxx2.subscribe('onSelectedItemChange', function(e, id, index){
//               console.log('key - ' + id + ' index - ' + index);
//            });

            require(['SBIS3.CONTROLS/Link'], function(btn){
               var myBtn = new btn ({
                  caption : 'Data',
                  element: $('#btn'),
                  visible: true,
                  enabled: true
               });

               var myBtn2 = new btn ({
                  caption : 'Data remove',
                  element: $('#btn2'),
                  visible: true,
                  enabled: true
               });

               myBtn2.subscribe('onActivated', function(){
                  var psina = $ws.single.ControlStorage.getByName('psina');
                  var rec = psina.getItems().getRecordById(31);
                  psina.getItems().removeAt(6);
               });

               myBtn.subscribe('onActivated', function(){
                  var col2 = [
                     {
                        id: 31,
                        title: '((((((((((((((((((((',
                        par: 27,
                        groupField : 1,
                        color: 1
                     },
                     {
                        id: 32,
                        title: '))))))))))))))))))))',
                        par: 27,
                        groupField : 4,
                        color: 1
                     }
                  ];
                  var source = new Memory({
                     data: col2,
                     idProperty: 'id'
                  });

                  var query = new Query();
                  source.query(query).addCallback(function(list) {
                     var rs = list.getAll();
                     var psina = $ws.single.ControlStorage.getByName('psina');
                     psina.getItems().append(rs);
                     myBtn2.show();
                  });
               });


            })
         });



      });
   })
   });
</script>
</body>
</html>
