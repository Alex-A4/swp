(function(){var e={findChildPosition:function(h){for(var g=0;(h=h.previousSibling);g++){continue;}return g;},isDataNode:function(g){return g&&g.nodeValue!==null&&g.data!==null;},isAncestorOf:function(g,h){return !e.isDataNode(g)&&(g.contains(e.isDataNode(h)?h.parentNode:h)||h.parentNode==g);},isAncestorOrSelf:function(g,h){return e.isAncestorOf(g,h)||g==h;},findClosestAncestor:function(g,h){if(e.isAncestorOf(g,h)){while(h&&h.parentNode!=g){h=h.parentNode;}}return h;},getNodeLength:function(g){return e.isDataNode(g)?g.length:g.childNodes.length;},splitDataNode:function(h,i){if(!e.isDataNode(h)){return false;}var g=h.cloneNode(false);h.deleteData(i,h.length);g.deleteData(0,i);h.parentNode.insertBefore(g,h.nextSibling);}};var c={convertToDOMRange:function(j,g){function i(k,n,o){var l=g.createElement("a"),p=n.duplicate();p.collapse(o);var m=p.parentElement();try{do{m.insertBefore(l,l.previousSibling);p.moveToElementText(l);}while(p.compareEndPoints(o?"StartToStart":"StartToEnd",n)>=0&&l.previousSibling);if(p.compareEndPoints(o?"StartToStart":"StartToEnd",n)<=0&&l.nextSibling){p.setEndPoint(o?"EndToStart":"EndToEnd",n);k[o?"setStart":"setEnd"](l.nextSibling,p.text.length);}else{k[o?"setStartBefore":"setEndBefore"](l);}}catch(e){}finally{l.parentNode.removeChild(l);}}var h=new f(g);i(h,j,true);i(h,j,false);return h;},convertFromDOMRange:function(g){function i(s,q,r){var k=q[r?"startContainer":"endContainer"];var m=q[r?"startOffset":"endOffset"],l=0;var o=e.isDataNode(k)?k:k.childNodes[m];var n=e.isDataNode(k)?k.parentNode:k;if(k.nodeType==3||k.nodeType==4){l=m;}var j=q._document.createElement("a");n.insertBefore(j,o);var p=q._document.body.createTextRange();p.moveToElementText(j);j.parentNode.removeChild(j);s.setEndPoint(r?"StartToStart":"EndToStart",p);s[r?"moveStart":"moveEnd"]("character",l);}var h=g._document.body.createTextRange();i(h,g,true);i(h,g,false);return h;}};function f(g){this._document=g;this.startContainer=this.endContainer=g.body;this.endOffset=e.getNodeLength(g.body);}f.START_TO_START=0;f.START_TO_END=1;f.END_TO_END=2;f.END_TO_START=3;f.prototype={startContainer:null,startOffset:0,endContainer:null,endOffset:0,commonAncestorContainer:null,collapsed:false,_document:null,_refreshProperties:function(){this.collapsed=(this.startContainer==this.endContainer&&this.startOffset==this.endOffset);var g=this.startContainer;while(g&&g!=this.endContainer&&!e.isAncestorOf(g,this.endContainer)){g=g.parentNode;}this.commonAncestorContainer=g;},setStart:function(g,h){this.startContainer=g;this.startOffset=h;this._refreshProperties();},setEnd:function(g,h){this.endContainer=g;this.endOffset=h;this._refreshProperties();},setStartBefore:function(g){this.setStart(g.parentNode,e.findChildPosition(g));},setStartAfter:function(g){this.setStart(g.parentNode,e.findChildPosition(g)+1);},setEndBefore:function(g){this.setEnd(g.parentNode,e.findChildPosition(g));},setEndAfter:function(g){this.setEnd(g.parentNode,e.findChildPosition(g)+1);},selectNode:function(g){this.setStartBefore(g);this.setEndAfter(g);},selectNodeContents:function(g){this.setStart(g,0);this.setEnd(g,e.getNodeLength(g));},collapse:function(g){if(g){this.setEnd(this.startContainer,this.startOffset);}else{this.setStart(this.endContainer,this.endOffset);}},cloneContents:function(){return(function g(h){for(var i,j=document.createDocumentFragment();(i=h.next());){i=i.cloneNode(!h.hasPartialSubtree());if(h.hasPartialSubtree()){i.appendChild(g(h.getSubtreeIterator()));}j.appendChild(i);}return j;})(new d(this));},extractContents:function(){var g=this.cloneRange();if(this.startContainer!=this.commonAncestorContainer){this.setStartAfter(e.findClosestAncestor(this.commonAncestorContainer,this.startContainer));}this.collapse(true);return(function h(i){for(var j,k=document.createDocumentFragment();(j=i.next());){i.hasPartialSubtree()?j=j.cloneNode(false):i.remove();if(i.hasPartialSubtree()){j.appendChild(h(i.getSubtreeIterator()));}k.appendChild(j);}return k;})(new d(g));},deleteContents:function(){var g=this.cloneRange();if(this.startContainer!=this.commonAncestorContainer){this.setStartAfter(e.findClosestAncestor(this.commonAncestorContainer,this.startContainer));}this.collapse(true);(function h(i){while(i.next()){i.hasPartialSubtree()?h(i.getSubtreeIterator()):i.remove();}})(new d(g));},insertNode:function(g){if(e.isDataNode(this.startContainer)){e.splitDataNode(this.startContainer,this.startOffset);this.startContainer.parentNode.insertBefore(g,this.startContainer.nextSibling);}else{this.startContainer.insertBefore(g,this.startContainer.childNodes[this.startOffset]);}this.setStart(this.startContainer,this.startOffset);},surroundContents:function(g){var h=this.extractContents();this.insertNode(g);g.appendChild(h);this.selectNode(g);},compareBoundaryPoints:function(k,l){var j,i,h,g;switch(k){case f.START_TO_START:case f.START_TO_END:j=this.startContainer;i=this.startOffset;break;case f.END_TO_END:case f.END_TO_START:j=this.endContainer;i=this.endOffset;break;}switch(k){case f.START_TO_START:case f.END_TO_START:h=l.startContainer;g=l.startOffset;break;case f.START_TO_END:case f.END_TO_END:h=l.endContainer;g=l.endOffset;break;}return j.sourceIndex<h.sourceIndex?-1:j.sourceIndex==h.sourceIndex?i<g?-1:i==g?0:1:1;},cloneRange:function(){var g=new f(this._document);g.setStart(this.startContainer,this.startOffset);g.setEnd(this.endContainer,this.endOffset);return g;},detach:function(){},toString:function(){return c.convertFromDOMRange(this).text;},createContextualFragment:function(g){var i=(e.isDataNode(this.startContainer)?this.startContainer.parentNode:this.startContainer).cloneNode(false);i.innerHTML=g;for(var h=this._document.createDocumentFragment();i.firstChild;){h.appendChild(i.firstChild);}return h;}};function d(h){this.range=h;if(h.collapsed){return;}var g=h.commonAncestorContainer;this._next=h.startContainer==g&&!e.isDataNode(h.startContainer)?h.startContainer.childNodes[h.startOffset]:e.findClosestAncestor(g,h.startContainer);this._end=h.endContainer==g&&!e.isDataNode(h.endContainer)?h.endContainer.childNodes[h.endOffset]:e.findClosestAncestor(g,h.endContainer).nextSibling;}d.prototype={range:null,_current:null,_next:null,_end:null,hasNext:function(){return !!this._next;},next:function(){var g=this._current=this._next;this._next=this._current&&this._current.nextSibling!=this._end?this._current.nextSibling:null;if(e.isDataNode(this._current)){if(this.range.endContainer==this._current){(g=g.cloneNode(true)).deleteData(this.range.endOffset,g.length-this.range.endOffset);}if(this.range.startContainer==this._current){(g=g.cloneNode(true)).deleteData(0,this.range.startOffset);}}return g;},remove:function(){if(e.isDataNode(this._current)&&(this.range.startContainer==this._current||this.range.endContainer==this._current)){var h=this.range.startContainer==this._current?this.range.startOffset:0;var g=this.range.endContainer==this._current?this.range.endOffset:this._current.length;this._current.deleteData(h,g-h);}else{this._current.parentNode.removeChild(this._current);}},hasPartialSubtree:function(){return !e.isDataNode(this._current)&&(e.isAncestorOrSelf(this._current,this.range.startContainer)||e.isAncestorOrSelf(this._current,this.range.endContainer));},getSubtreeIterator:function(){var g=new f(this.range._document);g.selectNodeContents(this._current);if(e.isAncestorOrSelf(this._current,this.range.startContainer)){g.setStart(this.range.startContainer,this.range.startOffset);}if(e.isAncestorOrSelf(this._current,this.range.endContainer)){g.setEnd(this.range.endContainer,this.range.endOffset);}return new d(g);}};function b(g){this._document=g;var h=this;g.attachEvent("onselectionchange",function(){h._selectionChangeHandler();});}b.prototype={rangeCount:0,_document:null,_selectionChangeHandler:function(){try{this.rangeCount=this._selectionExists(this._document.selection.createRange())?1:0;}catch(e){this.rangeCount=0;}},_selectionExists:function(g){return g.compareEndPoints("StartToEnd",g)!=0||g.parentElement().isContentEditable;},addRange:function(g){var h=this._document.selection.createRange(),i=c.convertFromDOMRange(g);if(!this._selectionExists(h)){i.select();}else{if(i.compareEndPoints("StartToStart",h)==-1){if(i.compareEndPoints("StartToEnd",h)>-1&&i.compareEndPoints("EndToEnd",h)==-1){h.setEndPoint("StartToStart",i);}else{if(i.compareEndPoints("EndToStart",h)<1&&i.compareEndPoints("EndToEnd",h)>-1){h.setEndPoint("EndToEnd",i);}}}h.select();}},removeAllRanges:function(){this._document.selection.empty();},getRangeAt:function(g){var h=this._document.selection.createRange();if(this._selectionExists(h)){return c.convertToDOMRange(h,this._document);}return null;},toString:function(){return this._document.selection.createRange().text;}};document.createRangeForIE=function(){return new f(document);};var a=new b(document);window.getSelectionForIE=function(){return a;};})();