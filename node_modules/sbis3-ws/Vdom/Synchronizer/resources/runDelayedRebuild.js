/**
 * Function runDelayedRebuild module <b>runDelayed(fn)</b>.
 *
 * Method checks if browser tab active or not and depending on tab state
 * calls function runDelayed function or setTimeout
 *
 * <h2>Function params</h2>
 * <ul>
 *     <li><b>fn</b> {Function} - function to be called asynchronously.</li>
 * </ul>
 *
 * @class Vdom/Synchronizer/resources/runDelayedRebuild
 * @public
 * @author Изыгин Н.Р.
 */
define('Vdom/Synchronizer/resources/runDelayedRebuild', [
   'Core/helpers/Function/runDelayed'
], function (runDelayed) {
   var checkPageVisibility = function checkPageVisibility() {
         var hidden = false;
         if (typeof document !== "undefined") {
            if (typeof document.hidden !== "undefined") { // Opera 12.10 and Firefox 18 and later support 
               hidden = "hidden";
            } else if (typeof document.msHidden !== "undefined") {
               hidden = "msHidden";
            } else if (typeof document.webkitHidden !== "undefined") {
               hidden = "webkitHidden";
            }
         }
         return hidden;
      },
      pageVisibility = checkPageVisibility();

   return function runDelayedRebuild(fn) {
      if (pageVisibility && document[pageVisibility]) {
         setTimeout(fn, 0);
      } else {
         runDelayed(fn);
      }
   }
});