define('Core/helpers/vdomCtxFields', [
   'View/Runner/common',
   'Core/compatibility',
   'optional!Controls/Container/Scroll/Context',
   'optional!OnlinePage/Context/UserInfo',
   'optional!Controls/Context/TouchContextField',
   'optional!UserActivity/ActivityContextField'
], function(
   utils,
   compability,
   ScrollData,
   UserInfoContextField,
   TouchContextField,
   ActivityContextField) {

   /**
    * Модуль, содержащий все VDOM контексты с новых страниц, построенных на VDOM.
    * Необходим для внедрения новых компонентов, использующих новые контексты, в старые страницы.
    */

   return function() {
      if (!utils.isCompat()) {
         return {};
      }
      var
         hash = {},
         userInfo = window ? window.userInfo : process && process.domain && process.domain.req && process.domain.req.userInfo;

      if (UserInfoContextField) {
         hash.userInfoField = new UserInfoContextField(userInfo);
      }
      if (ScrollData) {
         hash.ScrollData = new ScrollData({pagingVisible: false});
      }
      if (TouchContextField) {
         hash.isTouch = new TouchContextField(compability.touch);
      }
      if (ActivityContextField) {
         hash.activityContextField = new ActivityContextField();
      }

      return hash;
   };
});
