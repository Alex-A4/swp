/// <amd-module name="SbisFile/DIUploader/Image" />
// @ts-ignore
import Di = require('WS.Data/Di');
import LazyAttach = require('File/Attach/Lazy');
import LocalFile = require('File/LocalFile');
import FileSystem = require('File/ResourceGetter/FileSystem');

/**
 * Возвращает через DI подготовленный Attach под загрузку картинок в БЛ
 * https://online.sbis.ru/opendoc.html?guid=f062da1d-d2e1-48a2-9950-46a86c8dd493
 * @name SbisFile/DIUploader/Image
 * @author Ибрагимов А.А
 */
function ImageAttacher(options) {
   var attach = new LazyAttach({
      multiSelect: false
   });

   var fileSystem = new FileSystem({
      element: options.element,
      extensions: ['image']
   });

   attach.registerGetter(fileSystem);
   attach.registerLazyGetter('PhotoCam', 'File/ResourceGetter/PhotoCam', {
      openDialog: {
         dialogOptions: {
            opener: options.opener
         }
      }
   });

   attach.registerLazySource(LocalFile, 'SbisFile/Source/BL', {
      endpoint: {
         // todo Удалить, временная опция для поддержки смены логотипа компании
         contract: options.contract
      },
      binding: options.binding
   });
   return attach;
}

Di.register('ImageAttachGetter', ImageAttacher);
