/// <amd-module name="Data/_collection/MapEnumerator" />
/**
 * Энумератор для Map
 * @class WS.Data/Collection/MapEnumerator
 * @implements WS.Data/Collection/IEnumerator
 * @public
 * @author Мальцев А.А.
 */

import IEnumerator from './IEnumerator';
import {Map} from '../shim';

export default class MapEnumerator<T> implements IEnumerator<T> /** @lends WS.Data/Collection/MapEnumerator.prototype */{
   readonly '[Data/_collection/IEnumerator]' = true;

   /**
    * @property {Map} Объект
    */
   protected _items: Map<any, T>;
   /**
    * @property {Number} Текущий индекс
    */
   protected _index: number;

   /**
    * @property {Array} Кэш ключей
    */
   protected _cachedKeys: Array<string>;

   /**
    * @property {Array} Ключи
    */
   get _keys() {
      if (!this._cachedKeys) {
         const keys = [];
         this._items.forEach((value, key) => {
            keys.push(key);
         });
         this._cachedKeys = keys;
      }
      return this._cachedKeys;
   }

   /**
    * Конструктор
    * @param {Map} items Массив
    */
   constructor(items: Map<any, any>) {
      if (items === undefined) {
         items = new Map();
      }
      if (!(items instanceof Map)) {
         throw new Error('Argument items should be an instance of Map');
      }
      this._items = items;
   }

   // region Data/_collection/IEnumerator

   getCurrent() {
      return this._index === -1 ? undefined : this._items.get(this._keys[this._index]);
   }

   moveNext() {
      const keys = this._keys;
      if (this._index >= keys.length - 1) {
         return false;
      }

      this._index++;
      return true;
   }

   reset() {
      this._cachedKeys = undefined;
      this._index = -1;
   }

   // endregion Data/_collection/IEnumerator

   // region Public methods

   getCurrentIndex() {
      return this._keys[this._index];
   }

   // endregion Public methods
}

MapEnumerator.prototype['[Data/_collection/MapEnumerator]'] = true;
// @ts-ignore
MapEnumerator.prototype._items = null;
// @ts-ignore
MapEnumerator.prototype._index = -1;
// @ts-ignore
MapEnumerator.prototype._cachedKeys = undefined;
