/// <amd-module name="Data/_collection/factory/recordSet" />
/**
 * Фабрика для получения рекордсета из WS.Data/Collection/IEnumerable.
 * @class WS.Data/Collection/Factory/RecordSet
 * @public
 * @author Мальцев А.А.
 */

import IEnumerable from '../IEnumerable';
import RecordSet from '../RecordSet';
import {Record} from '../../type';
import {di} from '../../util';

interface IOptions {
   rawData?: any
}

/**
 * @alias WS.Data/Collection/Factory/RecordSet
 * @param {WS.Data/Collection/IEnumerable.<WS.Data/Entity/Record>} items Коллекция записей
 * @param {Object} [options] Опции конструктора рекордсета
 * @return {WS.Data/Collection/RecordSet}
 */
export default function recordSet(items: IEnumerable<Record>, options?: IOptions): RecordSet<Record> {
   if (!items || !(items['[Data/_collection/IEnumerable]'])) {
      throw new TypeError('Argument "items" should implement Data/collection:IEnumerable');
   }

   const Factory = di.resolve(
      di.isRegistered('collection.$recordset') ? 'collection.$recordset' : 'Data/collection:RecordSet'
   );

   options = options || {};
   delete options.rawData;

   let result = new Factory(options);
   items.each((item) => {
      result.add(item);
   });

   return result;
}
