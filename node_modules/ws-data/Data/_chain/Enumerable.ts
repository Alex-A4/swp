/// <amd-module name="Data/_chain/Enumerable" />
/**
 * Цепочка по IEnumerable.
 * @class WS.Data/Chain/Enumerable
 * @extends WS.Data/Chain/Abstract
 * @public
 * @author Мальцев А.А.
 */

import Abstract from './Abstract';
import {IEnumerator} from '../collection';

export default class Enumerable<T> extends Abstract<T> /** @lends WS.Data/Chain/Enumerable.prototype */{
   constructor(source) {
      if (!source || !source['[Data/_collection/IEnumerable]']) {
         throw new TypeError('Source must implement Data/collection:IEnumerable');
      }
      super(source);
   }

   // region Data/_collection/IEnumerable

   getEnumerator(): IEnumerator<T> {
      return this._source.getEnumerator();
   }

   each(callback: (item: any, index: number) => void, context?: Object) {
      return this._source.each(callback, context);
   }

   // endregion Data/_collection/IEnumerable

   // region Data/_chain/Abstract

   toObject(): Object {
      if (this._source['[Data/_type/IObject]']) {
         const result = {};
         this.each((key, value) => {
            result[key] = value;
         });
         return result;
      }
      return super.toObject();
   }

   // endregion Data/_chain/Abstract
}

Enumerable.prototype['[Data/_chain/Enumerable]'] = true;
