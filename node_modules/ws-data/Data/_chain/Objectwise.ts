/// <amd-module name="Data/_chain/Objectwise" />
/**
 * Цепочка по объекту.
 * @class WS.Data/Chain/Object
 * @extends WS.Data/Chain/Abstract
 * @public
 * @author Мальцев А.А.
 */

import Abstract from './Abstract';
import {ObjectEnumerator} from '../collection';

export default class Objectwise<T> extends Abstract<T> /** @lends WS.Data/Chain/Object.prototype */{
   protected _source: Object;

   constructor(source: Object) {
      if (!(source instanceof Object)) {
         throw new TypeError('Source should be an instance of Object');
      }
      super(source);
   }

   // region Data/_collection/IEnumerable

   getEnumerator(): ObjectEnumerator<T> {
      return new ObjectEnumerator(this._source);
   }

   each(callback: (item: any, index: number) => void, context?: Object) {
      const keys = Object.keys(this._source);
      const count = keys.length;
      let key;

      for (let i = 0; i < count; i++) {
         key = keys[i];
         callback.call(
            context || this,
            this._source[key],
            key
         );
      }
   }

   value(factory?: Function): Object {
      if (factory instanceof Function) {
         return super.value(factory);
      }

      return this.toObject();
   }

   // endregion Data/_collection/IEnumerable
}

Objectwise.prototype['[Data/_chain/Objectwise]'] = true;
