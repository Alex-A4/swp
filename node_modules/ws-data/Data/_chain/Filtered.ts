/// <amd-module name="Data/_chain/Filtered" />
/**
 * Фильтрующее звено цепочки.
 * @class WS.Data/Chain/Filtered
 * @extends WS.Data/Chain/Abstract
 * @public
 * @author Мальцев А.А.
 */

import Abstract from './Abstract';
import FilteredEnumerator from './FilteredEnumerator';

interface CallbackFunc {
   (item: any, index: number): boolean;
}

export default class Filtered<T> extends Abstract<T> /** @lends WS.Data/Chain/Filtered.prototype */{
   /**
    * @property {Function(*, Number): Boolean} Фильтр
    */
   protected _callback: CallbackFunc;

   /**
    * @property {Object} Контекст вызова _callback
    */
   protected _callbackContext: Object;

   /**
    * Конструктор фильтрующего звена цепочки.
    * @param {WS.Data/Chain/Abstract} source Предыдущее звено.
    * @param {Function(*, Number): Boolean} callback Фильтр
    * @param {Object} [callbackContext] Контекст вызова callback
    */
   constructor(source: Abstract<T>, callback: CallbackFunc, callbackContext: Object) {
      super(source);
      this._callback = callback;
      this._callbackContext = callbackContext;
   }

   destroy() {
      this._callback = null;
      this._callbackContext = null;
      super.destroy();
   }

   // region WS.Data/Collection/IEnumerable

   getEnumerator(): FilteredEnumerator<T> {
      return new FilteredEnumerator(
         this._previous,
         this._callback,
         this._callbackContext
      );
   }

   // endregion WS.Data/Collection/IEnumerable

   // region WS.Data/Chain/Abstract

   // endregion WS.Data/Chain/Abstract
}

Filtered.prototype['[Data/_chain/Filtered]'] = true;
