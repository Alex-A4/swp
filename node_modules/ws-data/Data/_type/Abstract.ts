/// <amd-module name="Data/_type/Abstract" />
/**
 * Абстрактная сущность.
 * Явлется прототипом большинства сущностей.
 * Обладает аспектом состояния "экземпляр разрушен".
 * Это абстрактный класс, не предназначенный для создания самостоятельных экземпляров.
 * @class WS.Data/Entity/Abstract
 * @public
 * @author Мальцев А.А.
 */

import {protect} from '../util';

const $destroyed = protect('destroyed');

function dontTouchDeads() {
   throw new ReferenceError('This class instance is destroyed.');
}

export default abstract class Abstract /** @lends WS.Data/Entity/Abstract.prototype */{
   /**
    * Экземпляр был разрушен
    */
   public get destroyed(): boolean {
      return Boolean(this[$destroyed]);
   }

   /**
    * Разрушает экземпляр
    */
   public destroy() {
      this[$destroyed] = true;

      for (const key in this) {
         switch (key) {
            case 'destroy':
            case 'destroyed':
            case 'isDestroyed':
               break;
            default:
               if (typeof this[key] === 'function') {
                  this[<string>key] = dontTouchDeads;
               }
         }
      }
   }

   //FIXME: deprecated
   private isDestroyed(): boolean {
      return this.destroyed;
   }
}

Abstract.prototype['[Data/_type/Abstract]'] = true;
