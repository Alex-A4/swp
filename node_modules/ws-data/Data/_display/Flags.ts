/// <amd-module name="Data/_display/Flags" />
/**
 * Проекция типа "Флаги".
 * @class WS.Data/Display/Flags
 * @extends WS.Data/Display/Collection
 * @public
 * @author Мальцев А.А.
 */

import Collection from './Collection';
import './FlagsItem';
import {di} from '../util';

interface IOptions {
}

/**
 * Обрабатывает событие об изменении состояния Flags
 * @param event Дескриптор события
 * @param name Название флага
 * @param index Индекс флага
 */
function onSourceChange (event: EventObject, name: string, index: number) {
   let item = this.at(this.getIndexBySourceIndex(index));
   this.notifyItemChange(item, 'selected');
}

export default class Flags extends Collection /** @lends WS.Data/Display/Flags.prototype */{
   constructor(options: IOptions) {
      super(options);

      if (!this._$collection['[Data/_collection/IFlags]']) {
         throw new TypeError(this._moduleName + ': source collection should implement WS.Data/Type/IFlags');
      }

      if (this._$collection['[Data/_type/ObservableMixin]']) {
         this._$collection.subscribe('onChange', this._onSourceChange);
      }
   }

   destroy() {
      if (this._$collection['[Data/_type/Abstract]'] &&
         this._$collection['[Data/_type/ObservableMixin]'] &&
         !this._$collection.destroyed
      ) {
         this._$collection.unsubscribe('onChange', this._onSourceChange);
      }

      super.destroy();
   }

   protected _bindHandlers() {
      super._bindHandlers();

      this._onSourceChange = onSourceChange.bind(this);
   }
}

Flags.prototype._moduleName = 'Data/display:Flags';
Flags.prototype['[Data/_display/Flags]'] = true;
// @ts-ignore
Flags.prototype._itemModule = 'Data/display:FlagsItem';
// @ts-ignore
Flags.prototype._localize = true;

di.register('Data/display:Flags', Flags);
